{% extends 'ldap/admin/ldapadmin.base.html.twig' %}  

{% block title %}Centre d'administration - Utilisateurs actifs{% endblock %}

{% block body %}

<h1 class="border-bottom border-dark border-2 py-2">{{ title|trans }}</h1>

<script src="//cdn.jsdelivr.net/npm/featherlight@1.7.14/release/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<div class="row gx-4 m-0">

    {% for type, messages in app.flashes %}
    <div class="alert bg-{% if type == "error" %}danger{% else %}{{ type }}{% endif %} {% if type != "info" %}text-white{% endif %}">

    {% for message in messages %}
        <p class="m-0">
            {{ message|trans|raw}}
        </p>
    {% endfor %}
    </div>
{% endfor %}
    
    <div class="pb-2">
        {% if is_granted('create', user) %}
        <a class="text-decoration-none text-body" href="{{ path('ldapadmin_usercreate') }}">
            <span class="me-3">
                <i class="fa-solid fa-user-plus"></i>
                {{ 'createUser'|trans }}
            </span>
        </a>
        {% endif %}
        <a href="#" id ="refreshDatatable" class="text-decoration-none text-body">
            <span class="me-3"><i class="fa-solid fa-rotate"></i>&nbsp;{{ 'refresh' | trans }}</span>
        </a>
        
    </div> 
    <div id="table_user"></div>
    {{ sg_datatables_render(datatable) }}
</div>
<script>

$(document).ready(function(){

    var oTable = $('#sg-datatables-user_datatable').on( 'init.dt', function () {
        $('#sg-datatables-user_datatable a[data-action="delete"]').on('click', function(event){
            event.preventDefault();
            var href=$(this).attr('href');
            var row = oTable.api().row($(this).parents('tr')).data();
            console.log(row);
            bootbox.confirm({
                size: 'small',
                locale: 'fr',
                message: "Voulez-vous vraiment supprimer l'utilisateur <i>"+row['nom']+"</i> (identifiant: <strong>"+row['identifiant']+"</strong>) ?",
                callback: function(result){
                    if(result){
                        document.location = href;
                    }
                }
            } )
        });
    } ).dataTable();
    $.fn.DataTable.ext.pager.numbers_length = 5;

    $('#sg-datatables-user_datatable_wrapper .bottom').addClass('row');
    $('#sg-datatables-user_datatable_wrapper .bottom>div').addClass('col-6');
    $('#sg-datatables-user_datatable_wrapper .bottom>div').addClass('py-0')
    $('#sg-datatables-user_datatable_wrapper .bottom>div').eq(1).find("label").addClass('float-end');
    $('.dropdown-toggle').on('show.bs.dropdown', function(){
        
    });
    
    $('#tab li:first-child button').trigger('click');

    
});

</script>

{% endblock %}